#include "NVP1208.h"

#define DTO_SET_COUNT		3

void InitializeNVP1104A(PDEVICE_EXTENSION pdx, BYTE bI2CPort, BYTE bDeviceAddr, BYTE bAudioStage)
{
	//////////////////////////////////////////////////////////////////////////
	//table for Video, 2010.09.17
	BYTE NVP1104A_NT_M_Buf[] = {
		//       0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F 
		/*00*/   0x00,0x00,0x00,0x00,0x00,0x10,0x32,0x10,0x32,0x54,0x76,0x10,0x32,0x00,0x00,0x00,
		/*10*/   0x00,0xEF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/*20*/   0x60,0xFF,0x00,0x02,0x9F,0x00,0x10,0x00,0x01,0x2E,0x99,0x00,0x00,0x0B,0x61,0x00,
		/*30*/   0x60,0xFF,0x00,0x02,0x9F,0x00,0x10,0x00,0x01,0x2E,0x99,0x00,0x00,0x0B,0x60,0x10,
		/*40*/   0x60,0xFF,0x00,0x02,0x9F,0x00,0x10,0x00,0x01,0x2E,0x99,0x00,0x00,0x0B,0x40,0x26,
		/*50*/   0x60,0xFF,0x00,0x02,0x9F,0x00,0x10,0x00,0x01,0x2E,0x99,0x00,0x00,0x0B,0x40,0x33,		
		/*60*/   0xD0,0x80,0x40,0x7C,0x9F,0x00,0x20,0x40,0x80,0x50,0x38,0x0F,0x0C,0x01,0x15,0x0A,
		/*70*/   0x80,0x23,0x88,0x04,0x2A,0xDC,0xF0,0x2F,0x57,0x43,0x10,0x80,0x82,0x03,0x10,0x00,
		/*80*/   0x80,0x00,0x00,0x81,0x0F,0x00,0x99,0x99,0x00,0x20,0x04,0x2E,0x00,0x30,0xB8,0x01,
		/*90*/   0x06,0x06,0x11,0xB9,0xB2,0x05,0x00,0x1F,0x50,0x51,0xB5,0x13,0x03,0x22,0xFF,0x00,
		
		/*A0*/   0x00,0x04,0x20,0x99,0x99,0x84,0x2B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
		/*B0*/   0x00,0x44,0x44,0x28,0x14,0x0F,0xAA,0xAA,0x02,0x00,0x00,0x00,0x00,0x01,0x07,0x10,
		
		/*C0*/   0x93,0x93,0x93,0x93,0x00,0x00,0x71,0x71,0x71,0x71,0x1C,0x1C,0x1C,0x1C,0x87,0x87,
		/*D0*/   0x87,0x87,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x10,0x80,0x10,0x00,0x00,
		/*E0*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x11,0x01,0x40,0x00,0x00,0x00,0x00,
		/*F0*/   0x00,0x00,0x20,0x04,0x00,0x00,0x80,0x02,0x75,0x20,0x0F,0x80,0x90,0x54,0x37
	};
	
	BYTE NVP1104A_PAL_B_Buf[] = {
		//       0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F 
		/*00*/   0x00,0x00,0x00,0x00,0x00,0x10,0x32,0x10,0x32,0x54,0x76,0x10,0x32,0x00,0x00,0x00,
		/*10*/   0x00,0xEF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/*20*/   0xBD,0x01,0x00,0x00,0x7E,0x00,0x00,0x04,0x01,0x10,0xBE,0x00,0x00,0x10,0x61,0x00,
		/*30*/   0xBD,0x01,0x00,0x00,0x7E,0x00,0x00,0x04,0x01,0x10,0xBE,0x00,0x00,0x10,0x60,0x10,
		/*40*/   0xBD,0x01,0x00,0x00,0x7E,0x00,0x00,0x04,0x01,0x10,0xBE,0x00,0x00,0x10,0x40,0x26,
		/*50*/   0xBD,0x01,0x00,0x00,0x7E,0x00,0x00,0x04,0x01,0x10,0xBE,0x00,0x00,0x10,0x40,0x33,
		/*60*/   0xD0,0x80,0x40,0x7C,0x9F,0x00,0x20,0x40,0x80,0x50,0x38,0x0F,0x0C,0x01,0x15,0x0A,		
		/*70*/   0x80,0x23,0x88,0x04,0x2A,0xCC,0xF0,0x2F,0x57,0x43,0x10,0x80,0x01,0x03,0x11,0x00,
		/*80*/   0x80,0x00,0x00,0x81,0x09,0x00,0x99,0x99,0x00,0x20,0x04,0x2E,0x00,0x30,0xD8,0x01,
		/*90*/   0x06,0x06,0x11,0xB9,0xB2,0x05,0x00,0x28,0x50,0x51,0xA8,0x13,0x03,0x22,0xFF,0x00,
		
		/*A0*/   0x00,0x04,0x20,0x99,0x99,0x84,0x2B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
		/*B0*/   0x00,0x44,0x44,0x28,0x14,0x0F,0xAA,0xAA,0x02,0x00,0x00,0x00,0x00,0x01,0x07,0x10,
		
		/*C0*/   0x93,0x93,0x93,0x93,0x00,0x00,0x71,0x71,0x71,0x71,0x1C,0x1C,0x1C,0x1C,0x87,0x87,
		/*D0*/   0x87,0x87,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x10,0x80,0x10,0x00,0x00,
		/*E0*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x01,0x00,0x00,0x00,0x00,0x00,
		/*F0*/   0x00,0x00,0x20,0x04,0x00,0x00,0x80,0x0B,0x80,0x20,0x0F,0x80,0x90,0x54,0x37
	};
	/////////////////////////////////////////////////////////////////////////
	//Audio
	BYTE NVP1104A_AUDIO_FIRST_STAGE[] = 
	{
		//       0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F 
		/*A0*/   0x00,0x00,0x22,0x99,0x99,0x84,0x2B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
		/*B0*/   0x00,0x44,0x44,0x28,0x14,0x0F,0xAA,0xAA,0x0E,0x00,0x00,0x00,0x00,0x01,0x3F,0x10,
	};
	
	BYTE NVP1104A_AUDIO_MIDDLE_STAGE[] = 
	{
		//       0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F 
		/*A0*/   0x00,0x00,0x22,0x99,0x99,0x04,0x0B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
		/*B0*/   0x00,0x44,0x44,0x28,0x14,0x0F,0xAA,0xAA,0x0E,0x00,0x00,0x00,0x00,0x01,0x3F,0x10,
	};
	
	BYTE NVP1104A_AUDIO_LAST_STAGE[] = 
	{
		//       0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F 
		/*A0*/   0x00,0x00,0x22,0x99,0x99,0x04,0x1B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
		/*B0*/   0x00,0x44,0x44,0x28,0x14,0x0F,0xAA,0xAA,0x0E,0x00,0x00,0x00,0x00,0x01,0x3F,0x10,
	};
	
	BYTE NVP1104A_AUDIO_SINGLE_STAGE[] = 
	{
		//       0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F 
		/*A0*/   0x00,0x04,0x20,0x99,0x99,0x84,0x3B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
		/*B0*/   0x00,0x44,0x44,0x28,0x14,0x0F,0xAA,0xAA,0x0E,0x00,0x00,0x00,0x00,0x01,0x3F,0x10,
	};
	//////////////////////////////////////////////////////////////////////////
	DWORD dwLength;

	BYTE bSubAddr;
	BYTE *pTable;

	//////////////////////////////////////////////////////////////////////////
	//setting video
	if (pdx->m_byVideoFormat == VIDEO_FORMAT_NTSC)
		pTable = NVP1104A_NT_M_Buf;
	else
		pTable = NVP1104A_PAL_B_Buf;

	bSubAddr = 0x00;
	dwLength = 0xA0;
	I2C_WriteBurst(pdx, bI2CPort, bDeviceAddr, bSubAddr, pTable, dwLength);

	bSubAddr = 0xC0;
	dwLength = 0x3F;
	I2C_WriteBurst(pdx, bI2CPort, bDeviceAddr, bSubAddr, pTable+bSubAddr, dwLength);

	switch (bAudioStage)
	{
	case STAGE_FIRST:
		pTable = NVP1104A_AUDIO_FIRST_STAGE;
		break;
	case STAGE_MIDDLE:
		pTable = NVP1104A_AUDIO_MIDDLE_STAGE;
		break;
	case STAGE_LAST:
		pTable = NVP1104A_AUDIO_LAST_STAGE;
		break;
	case STAGE_SINGLE:
		pTable = NVP1104A_AUDIO_SINGLE_STAGE;
		break;
	default:
		pTable = NULL;
		break;
	}
	bSubAddr = 0xA0;
	dwLength = 0x20;
	if (pTable != NULL)
		I2C_WriteBurst(pdx, bI2CPort, bDeviceAddr, bSubAddr, pTable, dwLength);


	//////////////////////////////////////////////////////////////////////////
	//tuning
	if (bDeviceAddr == 0x72)
	{
		I2C_Write(pdx, 0, bDeviceAddr, 0x2E, 0x63);
	}

	//////////////////////////////////////////////////////////////////////////

}

void SetScaler(PDEVICE_EXTENSION pdx, BYTE bI2CPort, BYTE bDevAddr, BYTE bDecoder, DWORD H_DTO, DWORD V_DTO)
{
	BYTE bSubAddr_H_DTO[MAX_DECODER][DTO_SET_COUNT] = 
	{
		{ 0xC6, 0xCA, 0xCE },
		{ 0xC7, 0xCB, 0xCF },
		{ 0xC8, 0xCC, 0xD0 },
		{ 0xC9, 0xCD, 0xD1 }
	};
	BYTE bSubAddr_V_DTO[MAX_DECODER][DTO_SET_COUNT] = 
	{
		{ 0xD2, 0xD6, 0xCE },
		{ 0xD3, 0xD7, 0xCF },
		{ 0xD4, 0xD8, 0xD0 },
		{ 0xD5, 0xD9, 0xD1 }
	};
	BYTE *pHDTOData, *pVDTOData;
	BYTE bData;

	pHDTOData = (BYTE *)&H_DTO;
	pVDTOData = (BYTE *)&V_DTO;

	I2C_Read(pdx, bI2CPort, bDevAddr, bSubAddr_H_DTO[bDecoder][2], &bData);
	bData = ((pVDTOData[2]<<4)&0xF0) | (pHDTOData[2]&0x0F);
	
	I2C_Write(pdx, bI2CPort, bDevAddr, bSubAddr_H_DTO[bDecoder][0], pHDTOData[0]);
	I2C_Write(pdx, bI2CPort, bDevAddr, bSubAddr_H_DTO[bDecoder][1], pHDTOData[1]);
	I2C_Write(pdx, bI2CPort, bDevAddr, bSubAddr_V_DTO[bDecoder][0], pVDTOData[0]);
	I2C_Write(pdx, bI2CPort, bDevAddr, bSubAddr_V_DTO[bDecoder][1], pVDTOData[1]);
	I2C_Write(pdx, bI2CPort, bDevAddr, bSubAddr_H_DTO[bDecoder][2], bData);

}

void SetBrightnessEx(PDEVICE_EXTENSION pdx, BYTE byDMAChannel)	
//byExternalChannel 0 to 11
{
	BYTE byExternalChannel = byDMAChannel - EXTERNAL_VDEC_PATH_START;
	BYTE byCurDecoderCount = (pdx->m_byDecSection-1)*MAX_DECODER;
	BYTE byDevice, byDecoder;
	BYTE byPort = 0;
	BYTE bySubAddr;

	if (byExternalChannel>=byCurDecoderCount)
		return;		//no device


	byDevice = byExternalChannel/MAX_DECODER;
	byDecoder = byExternalChannel%MAX_DECODER;

	bySubAddr = NVP1104A_BRIGHTNESS(byDecoder);

	I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, pdx->Brightness[byDMAChannel]);
}

void SetContrastEx(PDEVICE_EXTENSION pdx, BYTE byDMAChannel)		
//byExternalChannel 0 to 11
{
	BYTE byExternalChannel = byDMAChannel - EXTERNAL_VDEC_PATH_START;
	BYTE byCurDecoderCount = (pdx->m_byDecSection-1)*MAX_DECODER;
	BYTE byDevice, byDecoder;
	BYTE byPort = 0;
	BYTE bySubAddr;
	
	if (byExternalChannel>=byCurDecoderCount)
		return;		//no device
	
	
	byDevice = byExternalChannel/MAX_DECODER;
	byDecoder = byExternalChannel%MAX_DECODER;
	
	bySubAddr = NVP1104A_CONTRAST(byDecoder);
	
	I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, pdx->Contrast[byDMAChannel]);
}

void SetHueEx(PDEVICE_EXTENSION pdx, BYTE byDMAChannel)		
//byExternalChannel 0 to 11
{
	BYTE byExternalChannel = byDMAChannel - EXTERNAL_VDEC_PATH_START;
	BYTE byCurDecoderCount = (pdx->m_byDecSection-1)*MAX_DECODER;
	BYTE byDevice, byDecoder;
	BYTE byPort = 0;
	BYTE bySubAddr;
	
	if (byExternalChannel>=byCurDecoderCount)
		return;		//no device
	
	
	byDevice = byExternalChannel/MAX_DECODER;
	byDecoder = byExternalChannel%MAX_DECODER;
	
	bySubAddr = NVP1104A_HUE(byDecoder);
	
	I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, pdx->Hue[byDMAChannel]);
}

void SetSaturationEx(PDEVICE_EXTENSION pdx, BYTE byDMAChannel)		
//byExternalChannel 0 to 11
{
	BYTE byExternalChannel = byDMAChannel - EXTERNAL_VDEC_PATH_START;
	BYTE byCurDecoderCount = (pdx->m_byDecSection-1)*MAX_DECODER;
	BYTE byDevice, byDecoder;
	BYTE byPort = 0;
	BYTE bySubAddr;
	
	if (byExternalChannel>=byCurDecoderCount)
		return;		//no device
	
	
	byDevice = byExternalChannel/MAX_DECODER;
	byDecoder = byExternalChannel%MAX_DECODER;
	
	bySubAddr = NVP1104A_SATURATION(byDecoder);
	
	I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, pdx->Saturation[byDMAChannel]);
}


void SetBlacknWhiteEx(PDEVICE_EXTENSION pdx, BYTE byExternalChannel)		
//byExternalChannel 0 to 11
{
	BYTE byCurDecoderCount = (pdx->m_byDecSection-1)*MAX_DECODER;
	BYTE byDevice, byDecoder;
	BYTE byPort = 0;
	BYTE bySubAddr;
	
	if (byExternalChannel>=byCurDecoderCount)
		return;		//no device
	
	
	byDevice = byExternalChannel/MAX_DECODER;
	byDecoder = byExternalChannel%MAX_DECODER;
	
}

void SetSharpnessEx(PDEVICE_EXTENSION pdx, BYTE byHSharpness, BYTE byVSharpness)
{
	BYTE byPort = 0;
	BYTE byDevice;
	BYTE byData;
	BYTE bySubAddr = NVP1104A_SHARPNESS;

	byData = ((byHSharpness<<4)&0xF0)|(byVSharpness&0x0F);

	for (byDevice=0;byDevice<pdx->m_byDecSection-1;byDevice++)
		I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, byData);
}

void SetAudioParametersEx(PDEVICE_EXTENSION pdx)
{
	BYTE byPort = 0;
	BYTE byDevice;
	BYTE byData;
	BYTE bySubAddr = NVP1104A_AUDIO_CTRL;

	for (byDevice=0;byDevice<pdx->m_byDecSection-1;byDevice++)
	{
		I2C_Read(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, &byData);
		if (pdx->m_bySampleFrequency == AUDIO_FRQ_8)
			byData &= ~(1<<2);
		else
			byData |= (1<<2);
		I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, byData);
	}
}

//////////////////////////////////////////////////////////////////////////
//AFE setting
void InitializeNVP1104A_AFE(PDEVICE_EXTENSION pdx, BYTE bI2CPort, BYTE bDeviceAddr)
{
	BYTE NVP1104A_NT_M_Buf_AFE[] = {
		//	0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
			0x00,0x00,0x00,0x00,0x00,0x10,0x32,0x10,0x32,0x10,0x32,0x10,0x32,0x00,0x00,0x00,
	/*1*/   0x00,0xef,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	/*2*/   0x60,0x00,0x00,0x02,0x9f,0x00,0x00,0x00,0x06,0x10,0x95,0x00,0x00,0x8b,0x10,0x00,
	/*3*/   0x60,0x00,0x00,0x02,0x9f,0x00,0x00,0x00,0x06,0x10,0x95,0x00,0x00,0x8b,0x10,0x11,
	/*4*/   0x60,0x00,0x00,0x02,0x9f,0x00,0x00,0x00,0x06,0x10,0x95,0x00,0x00,0x8b,0x40,0x25,
	/*5*/   0x60,0x00,0x00,0x02,0x9f,0x00,0x00,0x00,0x06,0x10,0x95,0x00,0x00,0x8b,0x50,0x35,
	/*6*/   0xD0,0x80,0x40,0x7C,0x9f,0x00,0x20,0x80,0x80,0x45,0x38,0x0f,0x0C,0x01,0x15,0x0A,
	/*7*/   0x80,0x23,0x88,0x04,0x2A,0xCC,0xF0,0x2F,0x57,0x43,0x10,0x88,0x82,0x63,0x01,0x00,
	/*8*/   0x80,0x00,0x00,0x81,0x01,0x00,0x00,0x00,0xFF,0xCF,0x00,0x00,0x00,0x30,0xB8,0x01,
	/*9*/   0x06,0x06,0x11,0xb9,0xb2,0x05,0x00,0x1F,0x50,0x51,0xB5,0x13,0x03,0x22,0x00,0x00,
	/*A*/   0x00,0x04,0x20,0x88,0x88,0x84,0x3B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
	/*B*/   0x00,0x44,0x44,0x88,0x14,0x0F,0xAA,0xAA,0x0A,0x00,0x00,0x00,0x00,0x01,0x3F,0x10,
	/*C*/   0x13,0x13,0x13,0x13,0x00,0x00,0x71,0x71,0x71,0x71,0x1c,0x1c,0x1c,0x1c,0x87,0x87,
	/*D*/   0x87,0x87,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x10,0x80,0x10,0x00,0x00,
	/*E*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x11,0x01,0x40,0x00,0x00,0x00,0x00,
	/*F*/	0x00,0x00,0x10,0x86,0x00,0x00,0x80,0x00,0x69,0x20,0x00,0x80,0x90,0x54,0x37
	};
	
	BYTE NVP1104A_PAL_B_Buf_AFE[] = {
		//	0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
			0x00,0x00,0x00,0x00,0x00,0x10,0x32,0x10,0x32,0x10,0x32,0x10,0x32,0x00,0x00,0x00,
	/*1*/   0x00,0xef,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	/*2*/   0xBd,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x07,0x10,0xac,0x00,0x00,0x10,0x10,0x00,
	/*3*/   0xBd,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x07,0x10,0xac,0x00,0x00,0x10,0x10,0x11,
	/*4*/   0xBd,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x07,0x10,0xac,0x00,0x00,0x10,0x40,0x25,
	/*5*/   0xBd,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x07,0x10,0xac,0x00,0x00,0x10,0x50,0x35,
	/*6*/   0xD0,0x80,0x40,0x7C,0x9f,0x00,0x20,0x80,0x80,0x45,0x38,0x0f,0x0C,0x01,0x15,0x0A,
	/*7*/   0x80,0x23,0x88,0x04,0x2A,0xCC,0xF0,0x2F,0x57,0x43,0x10,0x88,0x01,0x63,0x01,0x00,
	/*8*/   0x80,0x00,0x00,0x81,0x01,0x00,0x00,0x00,0xFF,0xCF,0x00,0x00,0x00,0x30,0xB8,0x01,
	/*9*/   0x06,0x06,0x11,0xb9,0xb2,0x05,0x00,0x28,0x50,0x51,0x90,0x13,0x03,0x22,0xff,0x00,
	/*A*/   0x00,0x04,0x20,0x88,0x88,0x84,0x3B,0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x04,
	/*B*/   0x00,0x44,0x44,0x88,0x14,0x0F,0xAA,0xAA,0x0A,0x00,0x00,0x00,0x00,0x01,0x3F,0x10,
	/*C*/   0x13,0x13,0x13,0x13,0x00,0x00,0x71,0x71,0x71,0x71,0x1c,0x1c,0x1c,0x1c,0x87,0x87,
	/*D*/   0x87,0x87,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x10,0x80,0x10,0x00,0x00,
	/*E*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x11,0x01,0x40,0x00,0x00,0x00,0x00,
	/*F*/   0x00,0x00,0x10,0x86,0x00,0x00,0x80,0x00,0x7b,0x20,0x00,0x80,0x90,0x54,0x37
	};

	BYTE bSubAddr, *pTable;

	KdPrint(("Set NVP1104A to AFE mode\n"));

	if (pdx->m_byVideoFormat == VIDEO_FORMAT_NTSC)
		pTable = NVP1104A_NT_M_Buf_AFE;
	else
		pTable = NVP1104A_PAL_B_Buf_AFE;

	bSubAddr = 0x00;
	I2C_WriteBurst(pdx, bI2CPort, bDeviceAddr, bSubAddr, pTable, 0xFE);


}

void SetAudioGainEx(PDEVICE_EXTENSION pdx, BYTE byAudioChannel, BYTE byGain, BYTE byMute)
{
	BYTE byPort = 0;
	BYTE byDevice;
	BYTE bySubAddr;
	BYTE shift;
	BYTE byData;

	byAudioChannel -= EXTERNAL_AUDIO_START;
	byDevice = byAudioChannel/AUDIO_PATH;

	if (byDevice>=pdx->m_byDecSection-1)
		return;

	bySubAddr = NVP1104A_AUDIO_GAIN((byAudioChannel%AUDIO_PATH));
	shift = 4*((byAudioChannel+1)%2);

	I2C_Read(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, &byData);
	byData &= ~(0x0F<<shift);
	if (byMute)
		byGain = 0;
	else
		byGain &= 0x0F;
	byGain <<= shift;
	byData |= byGain;
	I2C_Write(pdx, byPort, pdx->byDevAddr[byDevice], bySubAddr, byData);

}